<!DOCTYPE html>
<html>
<head>
  <title>View Boats â€” Orcado Fish</title>

  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">

  <style>
    /* ===== General ===== */
    body {
      font-family: Poppins, Arial, sans-serif;
      background: #f5faff;
      color: #1f2937;
      margin: 0;
    }

    /* ===== Navigation ===== */
    nav {
      padding: 15px 40px;
      background: #e6f2ff;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
    }

    nav a {
      color: #1d4ed8;
      margin-right: 15px;
      text-decoration: none;
      font-weight: 500;
      transition: 0.3s;
    }

    nav a:hover {
      color: #2563eb;
    }

    /* ===== Container ===== */
    .container {
      max-width: 900px;
      margin: 30px auto;
      background: #ffffff;
      padding: 25px;
      border-radius: 14px;
      box-shadow: 0 4px 14px rgba(0,0,0,0.08);
    }

    h2 {
      text-align: center;
      color: #1e40af;
      margin-bottom: 20px;
    }

    /* ===== Controls ===== */
    input {
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #cbd5e1;
      font-family: Poppins;
      font-size: 14px;
      margin-right: 8px;
      width: 250px;
    }

    input:focus {
      outline: none;
      border-color: #3b82f6;
    }

    button {
      padding: 10px 14px;
      border-radius: 8px;
      background: #3b82f6;
      color: #ffffff;
      border: none;
      cursor: pointer;
      font-family: Poppins;
      font-size: 14px;
      font-weight: 500;
      transition: 0.3s;
    }

    button:hover {
      background: #2563eb;
    }

    /* ===== Table ===== */
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
      font-size: 14px;
    }

    th, td {
      padding: 10px;
      border: 1px solid #e2e8f0;
      text-align: left;
    }

    th {
      background: #f0f7ff;
      color: #1e3a8a;
      font-weight: 600;
    }

    tr:nth-child(even) {
      background: #f8fbff;
    }

    /* ===== Status ===== */
    .status {
      padding: 4px 10px;
      border-radius: 6px;
      font-weight: 600;
      font-size: 13px;
      display: inline-block;
    }

    .active {
      background: #dcfce7;
      color: #166534;
    }

    .expired {
      background: #fee2e2;
      color: #7f1d1d;
    }

    /* ===== Pagination ===== */
    .pagination {
      margin-top: 15px;
      text-align: center;
    }

    .pagination button {
      margin: 4px;
      padding: 6px 10px;
      font-size: 13px;
    }
  </style>
</head>

<body>

  <!-- ===== Navigation ===== -->
  <nav>
    <a href="index.html">Home</a>
    <a href="add-boat.html">Add Boat</a>
    <a href="view-boats.html">View Boats</a>
  </nav>

  <!-- ===== Content ===== -->
  <div class="container">
    <h2>Registered Boats</h2>

    <input id="searchBox" placeholder="Search boat / owner / location">
    <button onclick="exportExcel()">Export to Excel</button>

    <table id="boatTable">
      <thead>
        <tr>
          <th>Boat</th>
          <th>Owner</th>
          <th>Location</th>
          <th>Mobile</th>
          <th>Status</th>
          <th>Expiry</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <div class="pagination" id="pager"></div>
  </div>

  <!-- ===== Firebase ===== -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <script src="firebase-config.js"></script>

  <!-- ===== XLSX Export ===== -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

  <script>
    let boats = [], page = 1, size = 7;

    function subStatus(date) {
      const d = new Date(date), t = new Date();
      return d >= new Date(t.toDateString()) ? "Active" : "Expired";
    }

    database.ref("boats").on("value", snap => {
      boats = [];
      snap.forEach(c => boats.push(c.val()));
      render();
    });

    searchBox.addEventListener("keyup", () => {
      page = 1;
      render();
    });

    function render() {
      const q = searchBox.value.toLowerCase();
      const filtered = boats.filter(b =>
        (b.boatName || "").toLowerCase().includes(q) ||
        (b.ownerName || "").toLowerCase().includes(q) ||
        (b.location || "").toLowerCase().includes(q)
      );

      const start = (page - 1) * size;
      const pageData = filtered.slice(start, start + size);

      const body = document.querySelector("#boatTable tbody");
      body.innerHTML = "";

      pageData.forEach(b => {
        const s = subStatus(b.finishDate);
        body.innerHTML += `
          <tr>
            <td>${b.boatName}</td>
            <td>${b.ownerName}</td>
            <td>${b.location}</td>
            <td>${b.mobile}</td>
            <td><span class="status ${s === 'Active' ? 'active' : 'expired'}">${s}</span></td>
            <td>${b.finishDate}</td>
          </tr>`;
      });

      renderPager(filtered.length);
    }

    function renderPager(total) {
      const pages = Math.ceil(total / size);
      const p = document.getElementById("pager");
      p.innerHTML = "";
      for (let i = 1; i <= pages; i++) {
        p.innerHTML += `<button onclick="page=${i};render()">${i}</button>`;
      }
    }

    function exportExcel() {
      const wb = XLSX.utils.table_to_book(document.getElementById("boatTable"));
      XLSX.writeFile(wb, "boats_data.xlsx");
    }
  </script>

</body>
</html>
